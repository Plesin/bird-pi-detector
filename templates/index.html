<!doctype html>
<html>
  <head>
    <title>Bird Camera Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <div class="container">
      <h1>üê¶ Bird Camera Viewer</h1>

      <div class="stats">
        <p><strong>üìä Statistics</strong></p>
        <p>Total Photos: {{ photo_count }}</p>
        <p>Total Videos: {{ video_count }}</p>
        <p>Last Update: {{ current_time }}</p>
      </div>

      <button class="refresh-btn" onclick="location.reload()">
        üîÑ Refresh Gallery
      </button>

      <ul class="tabs" role="tablist">
        <li role="presentation">
          <a class="tab-link" role="tab" href="#live" data-tab="live">Live</a>
        </li>
        <li role="presentation">
          <a class="tab-link" role="tab" href="#photos" data-tab="photos"
            >Photos</a
          >
        </li>
        <li role="presentation">
          <a class="tab-link" role="tab" href="#videos" data-tab="videos"
            >Videos</a
          >
        </li>
      </ul>

      <section class="tab-panel" data-tab="live" role="tabpanel">
        <h2>üìπ Live Stream</h2>
        <div class="live-container">
          <div class="live-spinner show">
            <div class="spinner"></div>
          </div>
          <img
            data-src="{{ url_for('video_feed') }}"
            class="live-feed"
            alt="Live Camera Feed"
          />
        </div>
      </section>

      <section class="tab-panel" data-tab="photos" role="tabpanel">
        <h2>
          üì∏ Captured Photos{% if active_day_label %} - {{ active_day_label }}{%
          endif %}
        </h2>
        {% if days %} {% set has_any_photos = false %} {% for day in days %} {%
        if day.photos %} {% set has_any_photos = true %} {% if not
        active_day_label %}
        <h3 class="day-heading">
          <a href="{{ url_for('day_view', day_key=day.key) }}"
            >{{ day.label }}</a
          >
        </h3>
        {% endif %}
        <div class="gallery">
          {% for photo in day.photos %}
          <div class="gallery-item">
            <button
              class="thumb-btn photo-thumb"
              type="button"
              data-full="{{ url_for('serve_file', filename=photo.path) }}"
              data-title="{{ photo.path }}"
            >
              <img
                src="{{ url_for('serve_file', filename=photo.path) }}"
                alt="{{ photo.path }}"
              />
            </button>
            <div class="file-row">
              {% if photo.time_label %}
              <div class="time-label">{{ photo.time_label }}</div>
              {% endif %}
              <form
                class="delete-form"
                method="post"
                action="{{ url_for('delete_file', filename=photo.path) }}"
              >
                <button class="delete-btn" type="submit" title="Delete">
                  üóë
                </button>
              </form>
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %} {% endfor %} {% if not has_any_photos %}
        <p>No photos captured yet. Wait for birds to be detected!</p>
        {% endif %} {% else %}
        <p>No photos captured yet. Wait for birds to be detected!</p>
        {% endif %}
      </section>

      <section class="tab-panel" data-tab="videos" role="tabpanel">
        <h2>
          üé• Captured Videos{% if active_day_label %} - {{ active_day_label }}{%
          endif %}
        </h2>
        {% if days %} {% set has_any_videos = false %} {% for day in days %} {%
        if day.videos %} {% set has_any_videos = true %} {% if not
        active_day_label %}
        <h3 class="day-heading">
          <a href="{{ url_for('day_view', day_key=day.key) }}"
            >{{ day.label }}</a
          >
        </h3>
        {% endif %}
        <div class="gallery">
          {% for video in day.videos %}
          <div class="gallery-item">
            <video controls>
              <source
                src="{{ url_for('serve_file', filename=video.path) }}"
                type="video/x-msvideo"
              />
              Your browser doesn't support video playback.
            </video>
            <div class="file-row">
              {% if video.time_label %}
              <div class="time-label">{{ video.time_label }}</div>
              {% endif %}
              <form
                class="delete-form"
                method="post"
                action="{{ url_for('delete_file', filename=video.path) }}"
              >
                <button class="delete-btn" type="submit" title="Delete">
                  üóë
                </button>
              </form>
            </div>
            {% if audio_set and video.path.replace('.avi', '.wav') in audio_set
            %}
            <audio controls style="width: 100%; margin-top: 10px">
              <source
                src="{{ url_for('serve_file', filename=video.path.replace('.avi', '.wav')) }}"
                type="audio/wav"
              />
            </audio>
            {% endif %}
          </div>
          {% endfor %}
        </div>
        {% endif %} {% endfor %} {% if not has_any_videos %}
        <p>No videos captured yet.</p>
        {% endif %} {% else %}
        <p>No videos captured yet.</p>
        {% endif %}
      </section>
    </div>
    <dialog class="photo-dialog" id="photo-dialog">
      <div class="dialog-header">
        <div class="dialog-title" id="photo-dialog-title"></div>
        <button class="dialog-close" type="button" aria-label="Close">‚úï</button>
      </div>
      <img id="photo-dialog-image" alt="Preview" />
    </dialog>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>
